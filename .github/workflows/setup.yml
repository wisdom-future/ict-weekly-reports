name: è‡ªåŠ¨åˆ›å»ºé¡¹ç›®ç»“æž„

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ main ]
    paths: [ '.github/workflows/setup.yml' ]

jobs:
  setup-project:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: åˆ›å»ºé¡¹ç›®ç»“æž„
      run: |
        echo "ðŸš€ åˆ›å»ºICT TechInsighté¡¹ç›®ç»“æž„..."
        
        # åˆ›å»ºç›®å½•ç»“æž„
        mkdir -p config workflows/blueprints/{competitor_intelligence,academic_research,opensource_ecosystem,ai_analysis} workflows/{docs,schemas} scripts utils tests data/{sample,schemas} docs deployment/{docker,kubernetes}
        
        # åˆ›å»ºPythonåŒ…æ–‡ä»¶
        touch scripts/__init__.py utils/__init__.py tests/__init__.py config/__init__.py
        
        # åˆ›å»ºrequirements.txt
        cat > requirements.txt << 'EOF'
        requests>=2.31.0
        jsonschema>=4.17.0
        python-dateutil>=2.8.2
        pandas>=2.0.0
        numpy>=1.24.0
        python-dotenv>=1.0.0
        pytest>=7.3.0
        google-api-python-client>=2.86.0
        black>=23.0.0
        flake8>=6.0.0
        EOF
        
        # åˆ›å»º.gitignore
        cat > .gitignore << 'EOF'
        __pycache__/
        *.py[cod]
        .Python
        venv/
        .env
        *.log
        .DS_Store
        Thumbs.db
        EOF
        
        # åˆ›å»ºé…ç½®æ–‡ä»¶
        cat > config/settings.py << 'EOF'
        """ICT TechInsight é…ç½®è®¾ç½®"""
        import os
        from pathlib import Path

        PROJECT_ROOT = Path(__file__).parent.parent
        MAKE_API_KEY = os.getenv("MAKE_API_KEY", "")
        MAKE_TEAM_ID = os.getenv("MAKE_TEAM_ID", "")
        ALERT_EMAIL = os.getenv("ALERT_EMAIL", "")
        EOF
        
        # åˆ›å»ºAPIå¯†é’¥ç¤ºä¾‹æ–‡ä»¶
        cat > config/api_keys.example.env << 'EOF'
        MAKE_API_KEY=your_make_api_key_here
        MAKE_TEAM_ID=your_team_id_here
        ALERT_EMAIL=your_alert_email@example.com
        OPENAI_API_KEY=your_openai_key_here
        XAI_API_KEY=your_xai_key_here
        EOF
        
        # åˆ›å»ºæ—¥å¿—å·¥å…·
        cat > utils/logger.py << 'EOF'
        """æ—¥å¿—é…ç½®æ¨¡å—"""
        import logging
        import sys
        from pathlib import Path
        from datetime import datetime

        def setup_logger(name: str, level: str = "INFO"):
            """è®¾ç½®æ—¥å¿—è®°å½•å™¨"""
            log_dir = Path("logs")
            log_dir.mkdir(exist_ok=True)
            
            formatter = logging.Formatter(
                '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
            )
            
            logger = logging.getLogger(name)
            logger.setLevel(getattr(logging, level.upper()))
            
            if logger.handlers:
                return logger
            
            # æŽ§åˆ¶å°è¾“å‡º
            console_handler = logging.StreamHandler(sys.stdout)
            console_handler.setFormatter(formatter)
            logger.addHandler(console_handler)
            
            return logger
        EOF
        
        # åˆ›å»ºè“å›¾ç®¡ç†å™¨
        cat > scripts/blueprint_manager.py << 'EOF'
        #!/usr/bin/env python3
        """è“å›¾ç®¡ç†å™¨"""
        import json
        import argparse
        from pathlib import Path
        from typing import Dict, List

        class BlueprintManager:
            def __init__(self, base_path: str = "workflows/blueprints"):
                self.base_path = Path(base_path)
            
            def organize_blueprints(self):
                """æ•´ç†è“å›¾æ–‡ä»¶åˆ°ç›¸åº”ç›®å½•"""
                print("æ•´ç†è“å›¾æ–‡ä»¶...")
                
                blueprint_files = {
                    "Competitor_Intelligence_Collection.blueprint.json": "competitor_intelligence",
                    "Academic_Research_Collection.blueprint.json": "academic_research",
                    "OpenSource_Ecosystem_Collection.blueprint.json": "opensource_ecosystem",
                    "ICT_TechInsight_MultiModel_AI_Analysis_v3.0.blueprint.json": "ai_analysis"
                }
                
                for filename, category in blueprint_files.items():
                    print(f"æŸ¥æ‰¾æ–‡ä»¶: {filename}")
                    # è“å›¾æ–‡ä»¶éœ€è¦æ‰‹åŠ¨ä¸Šä¼ 
                
            def list_workflows(self) -> Dict:
                """åˆ—å‡ºæ‰€æœ‰å·¥ä½œæµ"""
                workflows = {}
                
                for category_dir in self.base_path.iterdir():
                    if category_dir.is_dir():
                        category_workflows = []
                        for blueprint_file in category_dir.glob("*.json"):
                            category_workflows.append({
                                "file": blueprint_file.name,
                                "path": str(blueprint_file)
                            })
                        workflows[category_dir.name] = category_workflows
                
                return workflows

        def main():
            parser = argparse.ArgumentParser(description="ICT TechInsight Blueprint Manager")
            parser.add_argument("action", choices=["organize", "list"], help="è¦æ‰§è¡Œçš„æ“ä½œ")
            
            args = parser.parse_args()
            
            manager = BlueprintManager()
            
            if args.action == "organize":
                manager.organize_blueprints()
            elif args.action == "list":
                workflows = manager.list_workflows()
                print(json.dumps(workflows, indent=2, ensure_ascii=False))

        if __name__ == "__main__":
            main()
        EOF
        
        # åˆ›å»ºæ•°æ®éªŒè¯å™¨
        cat > scripts/data_validator.py << 'EOF'
        #!/usr/bin/env python3
        """æ•°æ®éªŒè¯å™¨"""
        import json
        import argparse
        from typing import Dict
        from pathlib import Path

        class DataValidator:
            def validate_competitor_data(self, data: Dict) -> Dict:
                """éªŒè¯ç«žäº‰å¯¹æ‰‹æ•°æ®"""
                result = {
                    "valid": True,
                    "errors": [],
                    "warnings": []
                }
                
                required_fields = [
                    "company_name", "industry_category", "competitive_threat_level",
                    "innovation_index", "recent_news_count", "github_activity_score"
                ]
                
                for field in required_fields:
                    if field not in data or data[field] is None:
                        result["errors"].append(f"ç¼ºå°‘å¿…éœ€å­—æ®µ: {field}")
                        result["valid"] = False
                
                return result

        def main():
            parser = argparse.ArgumentParser(description="ICT TechInsight Data Validator")
            parser.add_argument("data_type", choices=["competitor", "academic", "opensource"])
            parser.add_argument("--file", required=True, help="è¦éªŒè¯çš„æ•°æ®æ–‡ä»¶")
            
            args = parser.parse_args()
            
            validator = DataValidator()
            
            try:
                with open(args.file, 'r', encoding='utf-8') as f:
                    data = json.load(f)
                
                if args.data_type == "competitor":
                    result = validator.validate_competitor_data(data)
                
                print(json.dumps(result, indent=2, ensure_ascii=False))
            
            except Exception as e:
                print(f"éªŒè¯å¤±è´¥: {str(e)}")

        if __name__ == "__main__":
            main()
        EOF
        
        # åˆ›å»ºç¤ºä¾‹æ•°æ®
        cat > data/sample/competitor_sample.json << 'EOF'
        {
          "company_name": "Example Corp",
          "industry_category": "Technology",
          "competitive_threat_level": "MEDIUM",
          "innovation_index": 75.5,
          "recent_news_count": 12,
          "github_activity_score": 850,
          "recent_patents_count": 3,
          "monitor_timestamp": "2024-06-17T10:30:00Z"
        }
        EOF
        
        cat > data/sample/academic_sample.json << 'EOF'
        {
          "paper_title": "Advanced Machine Learning Techniques in ICT",
          "authors": "Smith, J.; Johnson, A.; Brown, M.",
          "journal": "IEEE Transactions on Technology",
          "publish_date": "2024-05-15",
          "citation_count": 25,
          "doi": "10.1109/example.2024.001",
          "abstract": "This paper presents novel approaches to machine learning in ICT applications..."
        }
        EOF
        
        cat > data/sample/opensource_sample.json << 'EOF'
        {
          "repo_name": "awesome-ict-project/main",
          "description": "An innovative ICT framework for modern applications",
          "stars": 1250,
          "forks": 180,
          "language": "Python",
          "activity_score": 950,
          "maturity_level": "GROWING",
          "last_commit_days": 3
        }
        EOF
        
        # åˆ›å»ºæµ‹è¯•æ–‡ä»¶
        cat > tests/test_blueprints.py << 'EOF'
        """è“å›¾æµ‹è¯•æ¨¡å—"""
        import pytest
        import json
        from pathlib import Path

        def test_project_structure():
            """æµ‹è¯•é¡¹ç›®ç»“æž„"""
            assert Path("config").exists()
            assert Path("scripts").exists()
            assert Path("utils").exists()
            assert Path("workflows/blueprints").exists()
            assert Path("data/sample").exists()

        def test_sample_data():
            """æµ‹è¯•ç¤ºä¾‹æ•°æ®"""
            sample_files = [
                "data/sample/competitor_sample.json",
                "data/sample/academic_sample.json",
                "data/sample/opensource_sample.json"
            ]
            
            for sample_file in sample_files:
                path = Path(sample_file)
                assert path.exists(), f"ç¤ºä¾‹æ–‡ä»¶ä¸å­˜åœ¨: {sample_file}"
                
                with open(path, 'r', encoding='utf-8') as f:
                    data = json.load(f)
                
                assert isinstance(data, dict), f"{sample_file} å¿…é¡»æ˜¯JSONå¯¹è±¡"
                assert len(data) > 0, f"{sample_file} ä¸èƒ½ä¸ºç©º"
        EOF
        
        # æ›´æ–°README
        cat > README.md << 'EOF'
        # ICT TechInsight è‡ªåŠ¨åŒ–ç³»ç»Ÿ

        åŸºäºŽMake.comçš„ICTæŠ€æœ¯æ´žå¯Ÿè‡ªåŠ¨åŒ–æ•°æ®æ”¶é›†å’Œåˆ†æžç³»ç»Ÿã€‚

        ## ðŸš€ å¿«é€Ÿå¼€å§‹

        ### 1. å…‹éš†é¡¹ç›®
        ```bash
        git clone https://github.com/your-username/ICT-TechInsight-Automation.git
        cd ICT-TechInsight-Automation
        ```

        ### 2. è®¾ç½®PythonçŽ¯å¢ƒ
        ```bash
        # åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ
        python -m venv venv

        # æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ (Windows)
        venv\Scripts\activate

        # æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ (Linux/Mac)
        source venv/bin/activate

        # å®‰è£…ä¾èµ–
        pip install -r requirements.txt
        ```

        ### 3. é…ç½®APIå¯†é’¥
        ```bash
        # å¤åˆ¶é…ç½®æ–‡ä»¶
        cp config/api_keys.example.env .env

        # ç¼–è¾‘é…ç½®æ–‡ä»¶
        # å¡«å…¥æ‚¨çš„ Make.com API å¯†é’¥å’Œå…¶ä»–å¿…è¦é…ç½®
        ```

        ### 4. ä¸Šä¼ è“å›¾æ–‡ä»¶
        å°†æ‚¨çš„Make.comè“å›¾æ–‡ä»¶ä¸Šä¼ åˆ°å¯¹åº”ç›®å½•ï¼š
        - `workflows/blueprints/competitor_intelligence/`
        - `workflows/blueprints/academic_research/`
        - `workflows/blueprints/opensource_ecosystem/`
        - `workflows/blueprints/ai_analysis/`

        ### 5. è¿è¡Œæµ‹è¯•
        ```bash
        pytest tests/
        ```

        ## ðŸ“ é¡¹ç›®ç»“æž„

        ```
        ICT-TechInsight-Automation/
        â”œâ”€â”€ README.md
        â”œâ”€â”€ requirements.txt
        â”œâ”€â”€ .gitignore
        â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
        â”‚   â”œâ”€â”€ settings.py
        â”‚   â””â”€â”€ api_keys.example.env
        â”œâ”€â”€ workflows/              # Make.comå·¥ä½œæµ
        â”‚   â”œâ”€â”€ blueprints/        # è“å›¾æ–‡ä»¶
        â”‚   â”‚   â”œâ”€â”€ competitor_intelligence/
        â”‚   â”‚   â”œâ”€â”€ academic_research/
        â”‚   â”‚   â”œâ”€â”€ opensource_ecosystem/
        â”‚   â”‚   â””â”€â”€ ai_analysis/
        â”‚   â”œâ”€â”€ docs/              # å·¥ä½œæµæ–‡æ¡£
        â”‚   â””â”€â”€ schemas/           # æ•°æ®æž¶æž„
        â”œâ”€â”€ scripts/               # ç®¡ç†è„šæœ¬
        â”‚   â”œâ”€â”€ blueprint_manager.py
        â”‚   â””â”€â”€ data_validator.py
        â”œâ”€â”€ utils/                 # å·¥å…·æ¨¡å—
        â”‚   â””â”€â”€ logger.py
        â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
        â”‚   â””â”€â”€ test_blueprints.py
        â”œâ”€â”€ data/                  # æ•°æ®æ–‡ä»¶
        â”‚   â””â”€â”€ sample/           # ç¤ºä¾‹æ•°æ®
        â””â”€â”€ deployment/            # éƒ¨ç½²é…ç½®
        ```

        ## ðŸ› ï¸ å·¥å…·ä½¿ç”¨

        ### è“å›¾ç®¡ç†
        ```bash
        python scripts/blueprint_manager.py organize
        python scripts/blueprint_manager.py list
        ```

        ### æ•°æ®éªŒè¯
        ```bash
        python scripts/data_validator.py competitor --file data/sample/competitor_sample.json
        python scripts/data_validator.py academic --file data/sample/academic_sample.json
        python scripts/data_validator.py opensource --file data/sample/opensource_sample.json
        ```

        ## ðŸ“Š æ ¸å¿ƒåŠŸèƒ½

        - ðŸ” **ç«žäº‰å¯¹æ‰‹æƒ…æŠ¥æ”¶é›†** - è‡ªåŠ¨ç›‘æŽ§ç«žäº‰å¯¹æ‰‹åŠ¨æ€
        - ðŸ“š **å­¦æœ¯ç ”ç©¶æ”¶é›†** - æ”¶é›†å’Œåˆ†æžå­¦æœ¯è®ºæ–‡
        - ðŸŒŸ **å¼€æºç”Ÿæ€ç›‘æŽ§** - è·Ÿè¸ªå¼€æºé¡¹ç›®å’ŒæŠ€æœ¯è¶‹åŠ¿
        - ðŸ¤– **å¤šæ¨¡åž‹AIåˆ†æž** - æ™ºèƒ½åˆ†æžå’Œå†³ç­–æ”¯æŒ

        ## ðŸ¤ è´¡çŒ®æŒ‡å—

        1. Fork é¡¹ç›®
        2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
        3. æäº¤å˜æ›´ (`git commit -m 'Add some AmazingFeature'`)
        4. æŽ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
        5. å¼€å¯ Pull Request

        ## ðŸ“„ è®¸å¯è¯

        MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶
        EOF
        
        echo "âœ… é¡¹ç›®ç»“æž„åˆ›å»ºå®Œæˆï¼"
        echo "ðŸ“ ç›®å½•ç»“æž„ï¼š"
        find . -type d | head -20
        echo "ðŸ“„ ä¸»è¦æ–‡ä»¶ï¼š"
        find . -name "*.py" -o -name "*.json" -o -name "*.txt" -o -name "*.md" | head -20

    - name: æäº¤æ–‡ä»¶
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        git diff --staged --quiet || git commit -m "ðŸš€ è‡ªåŠ¨åˆ›å»ºICT TechInsighté¡¹ç›®ç»“æž„"
        git push
