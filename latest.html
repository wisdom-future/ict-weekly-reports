<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICT周报 - 最新报告</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        .container {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 20px;
        }
        .error {
            color: #ff6b6b;
            margin-top: 20px;
        }
        .manual-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            text-decoration: none;
            color: white;
            transition: background 0.3s;
        }
        .manual-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .debug-info {
            margin-top: 20px;
            font-size: 12px;
            opacity: 0.8;
            max-height: 150px;
            overflow-y: auto;
            text-align: left;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="spinner" id="spinner"></div>
        <div class="title">ICT周报</div>
        <div class="subtitle" id="status">正在获取最新报告...</div>
        <div id="error-message" class="error" style="display: none;"></div>
        <div id="manual-links" style="display: none;"></div>
        <div id="debug-info" class="debug-info" style="display: none;"></div>
    </div>

    <script>
        const statusEl = document.getElementById('status');
        const spinnerEl = document.getElementById('spinner');
        const errorEl = document.getElementById('error-message');
        const linksEl = document.getElementById('manual-links');
        const debugEl = document.getElementById('debug-info');

        function debug(message) {
            console.log(message);
            debugEl.innerHTML += message + '\n';
            debugEl.style.display = 'block';
        }

        async function getLatestReport() {
            try {
                statusEl.textContent = '正在连接GitHub API...';
                debug('🔄 开始获取文件列表...');
                
                const response = await fetch('https://api.github.com/repos/wisdom-future/ict-weekly-reports/contents/reports');
                
                if (!response.ok) {
                    throw new Error(`GitHub API请求失败: ${response.status}`);
                }
                
                const files = await response.json();
                statusEl.textContent = '正在分析报告文件...';
                debug(`📁 获取到 ${files.length} 个文件`);
                
                // 筛选出报告HTML文件
                const reportFiles = files.filter(file => {
                    const isHtml = file.name.endsWith('.html');
                    const isReport = file.name.startsWith('report-') && file.name.match(/report-\d{4}-\d{2}-\d{2}-\d{4}\.html$/);
                    debug(`📄 ${file.name} - 是HTML: ${isHtml}, 是报告: ${isReport}`);
                    return isHtml && isReport;
                });

                debug(`\n📊 筛选出 ${reportFiles.length} 个报告文件:`);
                reportFiles.forEach(file => debug(`   - ${file.name}`));

                if (reportFiles.length === 0) {
                    throw new Error('未找到符合格式的报告文件');
                }

                // 简单直接的排序：按文件名降序（因为文件名格式统一，字符串比较就够了）
                const sortedFiles = reportFiles.sort((a, b) => {
                    debug(`🔄 比较: ${a.name} vs ${b.name}`);
                    return b.name.localeCompare(a.name); // 降序，最新的在前
                });

                debug(`\n📋 排序后的文件列表:`);
                sortedFiles.forEach((file, index) => {
                    debug(`   ${index + 1}. ${file.name} ${index === 0 ? '← 最新' : ''}`);
                });

                const latestFile = sortedFiles[0];
                statusEl.textContent = `找到最新报告: ${latestFile.name}`;
                debug(`\n✅ 选择最新文件: ${latestFile.name}`);
                
                setTimeout(() => {
                    statusEl.textContent = '正在跳转...';
                    debug(`🚀 跳转到: ./reports/${latestFile.name}`);
                    window.location.href = `./reports/${latestFile.name}`;
                }, 3000); // 3秒延迟，方便查看调试信息
                
            } catch (error) {
                console.error('获取最新报告失败:', error);
                debug(`❌ 错误: ${error.message}`);
                showError(error.message);
            }
        }

        function showError(errorMessage) {
            spinnerEl.style.display = 'none';
            statusEl.textContent = '获取失败';
            errorEl.style.display = 'block';
            errorEl.innerHTML = `
                错误信息: ${errorMessage}<br><br>
                可能的原因：<br>
                • GitHub API访问限制<br>
                • 网络连接问题<br>
                • 文件名格式不匹配
            `;
            
            linksEl.style.display = 'block';
            linksEl.innerHTML = `
                <a href="https://github.com/wisdom-future/ict-weekly-reports/tree/main/reports" class="manual-link" target="_blank">
                    手动查看所有报告
                </a>
                <a href="./reports/report-2025-06-13-1321.html" class="manual-link">
                    直接访问最新报告
                </a>
            `;
        }

        // 页面加载后立即执行
        getLatestReport();
    </script>
</body>
</html>
