<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICTå‘¨æŠ¥ - æœ€æ–°æŠ¥å‘Š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        .container {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 20px;
        }
        .error {
            color: #ff6b6b;
            margin-top: 20px;
        }
        .manual-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            text-decoration: none;
            color: white;
            transition: background 0.3s;
        }
        .manual-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .debug-info {
            margin-top: 20px;
            font-size: 12px;
            opacity: 0.8;
            max-height: 150px;
            overflow-y: auto;
            text-align: left;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="spinner" id="spinner"></div>
        <div class="title">ICTå‘¨æŠ¥</div>
        <div class="subtitle" id="status">æ­£åœ¨è·å–æœ€æ–°æŠ¥å‘Š...</div>
        <div id="error-message" class="error" style="display: none;"></div>
        <div id="manual-links" style="display: none;"></div>
        <div id="debug-info" class="debug-info" style="display: none;"></div>
    </div>

    <script>
        const statusEl = document.getElementById('status');
        const spinnerEl = document.getElementById('spinner');
        const errorEl = document.getElementById('error-message');
        const linksEl = document.getElementById('manual-links');
        const debugEl = document.getElementById('debug-info');

        function debug(message) {
            console.log(message);
            debugEl.innerHTML += message + '\n';
            debugEl.style.display = 'block';
        }

        async function getLatestReport() {
            try {
                statusEl.textContent = 'æ­£åœ¨è¿æ¥GitHub API...';
                debug('ğŸ”„ å¼€å§‹è·å–æ–‡ä»¶åˆ—è¡¨...');
                
                const response = await fetch('https://api.github.com/repos/wisdom-future/ict-weekly-reports/contents/reports');
                
                if (!response.ok) {
                    throw new Error(`GitHub APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const files = await response.json();
                statusEl.textContent = 'æ­£åœ¨åˆ†ææŠ¥å‘Šæ–‡ä»¶...';
                debug(`ğŸ“ è·å–åˆ° ${files.length} ä¸ªæ–‡ä»¶`);
                
                // ç­›é€‰å‡ºæŠ¥å‘ŠHTMLæ–‡ä»¶
                const reportFiles = files.filter(file => {
                    const isHtml = file.name.endsWith('.html');
                    const isReport = file.name.startsWith('report-') && file.name.match(/report-\d{4}-\d{2}-\d{2}-\d{4}\.html$/);
                    debug(`ğŸ“„ ${file.name} - æ˜¯HTML: ${isHtml}, æ˜¯æŠ¥å‘Š: ${isReport}`);
                    return isHtml && isReport;
                });

                debug(`\nğŸ“Š ç­›é€‰å‡º ${reportFiles.length} ä¸ªæŠ¥å‘Šæ–‡ä»¶:`);
                reportFiles.forEach(file => debug(`   - ${file.name}`));

                if (reportFiles.length === 0) {
                    throw new Error('æœªæ‰¾åˆ°ç¬¦åˆæ ¼å¼çš„æŠ¥å‘Šæ–‡ä»¶');
                }

                // ç®€å•ç›´æ¥çš„æ’åºï¼šæŒ‰æ–‡ä»¶åé™åºï¼ˆå› ä¸ºæ–‡ä»¶åæ ¼å¼ç»Ÿä¸€ï¼Œå­—ç¬¦ä¸²æ¯”è¾ƒå°±å¤Ÿäº†ï¼‰
                const sortedFiles = reportFiles.sort((a, b) => {
                    debug(`ğŸ”„ æ¯”è¾ƒ: ${a.name} vs ${b.name}`);
                    return b.name.localeCompare(a.name); // é™åºï¼Œæœ€æ–°çš„åœ¨å‰
                });

                debug(`\nğŸ“‹ æ’åºåçš„æ–‡ä»¶åˆ—è¡¨:`);
                sortedFiles.forEach((file, index) => {
                    debug(`   ${index + 1}. ${file.name} ${index === 0 ? 'â† æœ€æ–°' : ''}`);
                });

                const latestFile = sortedFiles[0];
                statusEl.textContent = `æ‰¾åˆ°æœ€æ–°æŠ¥å‘Š: ${latestFile.name}`;
                debug(`\nâœ… é€‰æ‹©æœ€æ–°æ–‡ä»¶: ${latestFile.name}`);
                
                setTimeout(() => {
                    statusEl.textContent = 'æ­£åœ¨è·³è½¬...';
                    debug(`ğŸš€ è·³è½¬åˆ°: ./reports/${latestFile.name}`);
                    window.location.href = `./reports/${latestFile.name}`;
                }, 3000); // 3ç§’å»¶è¿Ÿï¼Œæ–¹ä¾¿æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯
                
            } catch (error) {
                console.error('è·å–æœ€æ–°æŠ¥å‘Šå¤±è´¥:', error);
                debug(`âŒ é”™è¯¯: ${error.message}`);
                showError(error.message);
            }
        }

        function showError(errorMessage) {
            spinnerEl.style.display = 'none';
            statusEl.textContent = 'è·å–å¤±è´¥';
            errorEl.style.display = 'block';
            errorEl.innerHTML = `
                é”™è¯¯ä¿¡æ¯: ${errorMessage}<br><br>
                å¯èƒ½çš„åŸå› ï¼š<br>
                â€¢ GitHub APIè®¿é—®é™åˆ¶<br>
                â€¢ ç½‘ç»œè¿æ¥é—®é¢˜<br>
                â€¢ æ–‡ä»¶åæ ¼å¼ä¸åŒ¹é…
            `;
            
            linksEl.style.display = 'block';
            linksEl.innerHTML = `
                <a href="https://github.com/wisdom-future/ict-weekly-reports/tree/main/reports" class="manual-link" target="_blank">
                    æ‰‹åŠ¨æŸ¥çœ‹æ‰€æœ‰æŠ¥å‘Š
                </a>
                <a href="./reports/report-2025-06-13-1321.html" class="manual-link">
                    ç›´æ¥è®¿é—®æœ€æ–°æŠ¥å‘Š
                </a>
            `;
        }

        // é¡µé¢åŠ è½½åç«‹å³æ‰§è¡Œ
        getLatestReport();
    </script>
</body>
</html>
