<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICT周报 - 最新报告</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }
        .container {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 20px;
        }
        .error {
            color: #ff6b6b;
            margin-top: 20px;
        }
        .manual-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            text-decoration: none;
            color: white;
            transition: background 0.3s;
        }
        .manual-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="spinner" id="spinner"></div>
        <div class="title">ICT周报</div>
        <div class="subtitle" id="status">正在获取最新报告...</div>
        <div id="error-message" class="error" style="display: none;"></div>
        <div id="manual-links" style="display: none;"></div>
    </div>

    <script>
        const statusEl = document.getElementById('status');
        const spinnerEl = document.getElementById('spinner');
        const errorEl = document.getElementById('error-message');
        const linksEl = document.getElementById('manual-links');

        async function getLatestReport() {
            try {
                statusEl.textContent = '正在连接GitHub API...';
                
                // 获取reports目录下的所有文件
                const response = await fetch('https://api.github.com/repos/wisdom-future/ict-weekly-reports/contents/reports');
                
                if (!response.ok) {
                    throw new Error(`GitHub API请求失败: ${response.status}`);
                }
                
                const files = await response.json();
                statusEl.textContent = '正在分析报告文件...';
                
                // 筛选HTML文件并按文件名排序
                const htmlFiles = files
                    .filter(file => file.name.endsWith('.html') && file.name.includes('report-'))
                    .sort((a, b) => {
                        // 提取文件名中的日期进行排序
                        const dateA = a.name.match(/(\d{4}-\d{2}-\d{2})/);
                        const dateB = b.name.match(/(\d{4}-\d{2}-\d{2})/);
                        if (dateA && dateB) {
                            return dateB[1].localeCompare(dateA[1]);
                        }
                        return b.name.localeCompare(a.name);
                    });

                if (htmlFiles.length > 0) {
                    const latestFile = htmlFiles[0];
                    statusEl.textContent = `找到最新报告: ${latestFile.name}`;
                    
                    // 显示即将跳转的信息
                    setTimeout(() => {
                        statusEl.textContent = '正在跳转...';
                        window.location.href = `./reports/${latestFile.name}`;
                    }, 1000);
                    
                } else {
                    throw new Error('未找到任何报告文件');
                }
                
            } catch (error) {
                console.error('获取最新报告失败:', error);
                spinnerEl.style.display = 'none';
                statusEl.textContent = '获取失败，尝试备用方案...';
                
                // 备用方案：尝试基于日期的文件名
                await tryDateBasedFiles();
            }
        }

        async function tryDateBasedFiles() {
            const today = new Date();
            const attempts = [];
            
            // 生成最近30天可能的文件名
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                // 尝试不同的文件名格式
                attempts.push(`report-${dateStr}-1212.html`);
                attempts.push(`report-${dateStr}.html`);
            }
            
            statusEl.textContent = '正在尝试可能的文件名...';
            
            for (const filename of attempts) {
                try {
                    const response = await fetch(`./reports/${filename}`, { method: 'HEAD' });
                    if (response.ok) {
                        statusEl.textContent = `找到报告: ${filename}`;
                        setTimeout(() => {
                            window.location.href = `./reports/${filename}`;
                        }, 1000);
                        return;
                    }
                } catch (error) {
                    continue;
                }
            }
            
            // 所有尝试都失败了
            showError();
        }

        function showError() {
            spinnerEl.style.display = 'none';
            statusEl.textContent = '未能找到最新报告';
            errorEl.style.display = 'block';
            errorEl.innerHTML = '可能的原因：<br>• 报告文件尚未上传<br>• 文件名格式不匹配<br>• 网络连接问题';
            
            // 显示手动链接选项
            linksEl.style.display = 'block';
            linksEl.innerHTML = `
                <a href="https://github.com/wisdom-future/ict-weekly-reports/tree/main/reports" class="manual-link" target="_blank">
                    查看所有报告
                </a>
            `;
        }

        // 页面加载后立即执行
        getLatestReport();
    </script>
</body>
</html>
